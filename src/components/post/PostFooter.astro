---
interface Props {
  date: Date
  updated?: Date
  permalink: string
  title: string
  author?: string
  siteName?: string
  showCopyright?: boolean
  showReward?: boolean
  rewardConfig?: {
    enable: boolean
    accounts?: Record<string, string>
  }
}

const {
  date,
  updated,
  permalink,
  title,
  author = 'Author',
  siteName = 'Site',
  showCopyright = true,
  showReward = false,
  rewardConfig,
} = Astro.props

function formatDate(d: Date): string {
  return d.toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
  })
}

const hasUpdated = updated && formatDate(date) !== formatDate(updated)
---

<footer>
  {
    hasUpdated && (
      <div class="meta">
        <span class="item">
          <span class="icon">
            <i class="ic i-ri-calendar-check-line" />
          </span>
          <span class="text">编辑于 </span>
          <time
            title={`修改于: ${updated.toLocaleString('zh-CN')}`}
            itemprop="dateModified"
            datetime={updated.toISOString()}
          >
            {formatDate(updated)}
          </time>
        </span>
      </div>
    )
  }

  {
    showReward && rewardConfig?.enable && (
      <div class="reward">
        <button type="button">
          <i class="ic i-ri-heart-pulse-line" />
          赞赏支持
        </button>
        <p>您的支持是我继续创作的动力</p>
        <div id="qr">
          {rewardConfig.accounts &&
            Object.entries(rewardConfig.accounts).map(([name, image]) => (
              <div>
                <img loading="lazy" src={image as string} alt={`${author} ${name}`} />
                <p>{name}</p>
              </div>
            ))}
        </div>
      </div>
    )
  }
  {
    showCopyright && (
      <div id="copyright">
        <ul>
          <li class="author">
            <div class="icon i-ri-account-circle-line"></div>
            <strong>文章作者: </strong>
            {author}
            <i class="ic i-ri-at-line">
              <em>@</em>
            </i>
            {siteName}
          </li>
          <li class="link">
            <div class="icon i-ri-link"></div>
            <strong>文章链接: </strong>
            <a href={permalink} title={title}>
              {permalink}
            </a>
          </li>
          <li class="license">
            <div class="icon i-ri-copyright-line"></div>
            <strong>版权声明: </strong>
            本文采用
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">
              <i class="ic i-ri-creative-commons-line">
                <em>(CC)</em>
              </i>
              BY-NC-SA 4.0
            </a>
            许可协议，转载请注明出处
          </li>
        </ul>
      </div>
    )
  }
</footer>
