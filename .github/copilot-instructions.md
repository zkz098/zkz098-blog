# Copilot instructions (astro-theme-shokax)

## Stack & runtime

- Astro 5 site; Bun is the expected runtime (`packageManager: bun@…`). Prefer the `bun run …` scripts in `package.json`.
- Svelte 5 is used for interactive UI and typically uses runes (`$state`, `$props`, `$effect`) — see `src/components/navbar/NavBar.svelte`.

## Where things live

- App shell: `src/layouts/Layout.astro` (NavBar, Sidebar, footer/widgets, global styles).
- Routes: `src/pages/**`.
- Posts/content: `src/posts/**/*.md` via Astro Content Collections; schema in `src/content.config.ts`.
- Theme configuration: `src/theme.config.ts` (typed by `src/toolkit/themeConfig.ts`).

## Routing & content conventions

- Post pages are generated by `src/pages/posts/[...slug].astro`.
  - URL pattern is `/posts/<post.id>/` where `post.id` is the entry id from `src/posts`.
  - This project enforces `trailingSlash: "always"` (see `astro.config.mjs`) — keep generated links with a trailing `/`.
- Pagination is intentionally split:
  - Page 1 is `/` from `src/pages/index.astro`.
  - Pages 2..N are `/page/<n>/` from `src/pages/page/[page].astro` (it filters out `page === "1"`).

## UI + hydration (Astro ⇄ Svelte)

- Svelte components are mounted from `.astro` via `client:*` directives (e.g. `<NavBar client:load />` in `Layout.astro`).
- Some Svelte components are custom elements (web components).
  - Example: `src/components/CodeBlock.svelte` declares `<svelte:options customElement="code-block" />`.
  - Custom-element pattern used here:
    - Ensure the custom element module is included by rendering it once (Layout has a hidden `<CodeBlock client:idle />`).
    - Then create/replace DOM nodes at runtime (see `src/toolkit/initCodeBlock.ts`, which wraps `.astro-code` blocks into `<code-block>`).

## Styling, icons, and UnoCSS gotchas

- UnoCSS is integrated via `unocss/astro` with Wind preset + icons + attributify (see `uno.config.ts`).
- Icon classes are `i-ri-…` (Iconify Remix Icon set), used heavily in Svelte markup (e.g. `src/components/navbar/NavBar.svelte`).
- Uno safelist is derived from `src/theme.config.ts` (nav/sidebar icons). Note: `uno.config.ts` cannot use the `@` alias (it imports theme config via a relative path by design).

## Search (Pagefind)

- Search UI is `@pagefind/default-ui` in `src/components/search/SearchPage.svelte`.
- Production build must include Pagefind indexing:
  - `bun run build` runs `astro build` AND `pagefind --site ./dist` (see `package.json`).
  - If you change markup, preserve `data-pagefind-body` usage (e.g. `src/pages/posts/[...slug].astro`).

## Dev workflows (use repo scripts)

- Dev server: `bun run dev`
- Type/content checks: `bun run check` (Astro check)
- Lint/format: `bun run lint` (oxlint, type-aware) and `bun run format` (oxfmt)
- Unit tests: `bun test` (tests live under `src/toolkit/**/*.test.ts`)

## Collaboration conventions (this repo)

- Use **Chinese** for AI agent output and code comments by default (中文注释/中文反馈优先)。
- When finishing work, **do not** create new Markdown files to “report” results. Summarize changes directly in chat.
- If adding dependencies to the repository, report **package name**, **what it does**, and **where it is used** (usage scope/files).
- After modifying code, run `bun run format` and `bun run lint`, then check IDE diagnostics (Problems) and fix any errors introduced by the change.
- Use MCP services when helpful (e.g. Svelte docs/autofix for Svelte work), but avoid MCP/tools that are outside this repo’s stack (e.g. Pylance/Python-specific services).
